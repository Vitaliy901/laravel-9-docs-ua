# Життевий цикл запитів

- [Вступ](#introduction)
- [Огляд життевого циклу](#lifecycle-overview)
  - [Перші кроки](#first-steps)
  - [HTTP-ядро та ядро консолі](#http-console-kernels)
  - [Постачальники служб](#service-providers)
  - [Маршрутизація](#routing)
  - [Завершення](#finishing-up)
- [Зосередження на постачальниках служб](#focus-on-service-providers)

<a name="introduction"></a>

## Вступ

Використовуючи будь-який інструмент в «реальному світі», ви почуваєтеся впевненіше, якщо розумієте, як цей інструмент працює. Розробка додатків нічим не відрізняється. Коли ви розумієте, як функціонують ваші інструменти розробки, ви відчуваєте себе комфортніше та впевненіше, користуючись ними.

Мета цього документа — це дати вам гарний огляд високого рівня того, як працює фреймворк Laravel. Ознайомившись з загальною структурою все здаватиметься менш «магічним», і ви зможете впевненіше створювати свої додатки. Якщо ви одразу не зрозуміли всі терміни, не засмучуйтесь! Просто спробуйте отримати базове уявлення про те, що відбувається, і ваші знання будуть зростати, коли ви досліджуватимете інші розділи документації.

<a name="lifecycle-overview"></a>

## Огляд життевого циклу

<a name="first-steps"></a>

### Перші кроки

Точкою входу для всіх запитів до додатка Laravel є файл `public/index.php`. Всі запити спрямовуються до цього файла за допомогою конфігурації веб-сервера (Apache / Nginx). Файл `index.php` не містить багато коду. Скоріше, це відправна точка для завантаження решти фреймворку.

Файл `index.php` завантажує автозавантажувача, створений менеджером пакунків Composer, а потім отримує екземпляр додатка Laravel з `bootstrap/app.php`. Першою дією, яку виконує сам Laravel, є створення екземпляра додатка / [контейнера служб](container.md).

<a name="http-console-kernels"></a>

### HTTP-ядро та ядро консолі

Далі, вхідний запит надсилається до HTTP-ядра або до ядра консолі, залежно від типу запита, який надходить до додатка. Ці два ядра служать місцем зосередження, через яке проходять всі запити. Наразі зосередимося лише на HTTP-ядрі, яке знаходиться в `app/Http/Kernel.php`.

HTTP-ядро розширює клас `Illuminate\Foundation\Http\Kernel`, який визначає масив початкових завантажень `bootstrappers`, які будуть запускатись перед виконанням запита. Ці `bootstrappers` налаштовують опрацювання помилок, налаштовують ведення журналів, [виявляють середовище додатка](configuration.md#environment-configuration) та виконують інші завдання, які потрібно виконати до фактичного опрацювання запита. Як правило, ці класи опрацьовують внутрішню конфігурацію Laravel, про яку вам не потрібно турбуватися.

HTTP-ядро також визначає список [HTTP-посередників](middleware.md), через які мають пройти всі запити, перш ніж їх опрацює додаток. Ці посередники опрацьовують читання та запис [HTTP-сесій](session.md), визначають, чи додаток перебуває в режимі обслуговування, [перевіряють CSRF-токен](csrf.md) тощо. Незабаром ми поговоримо про це більше.

Сигнатура метода `handle` HTTP-ядра досить проста: він отримує `Request`, а віддає `Response`. Уявіть ядро ​​як велику чорну скриньку, яка представляє весь ваш додаток. Дайте їй HTTP-запити, а вона віддасть HTTP-відповіді.

<a name="service-providers"></a>

### Постачальники служб

Однією з найважливіших дій початкового завантаження ядра є завантаження [постачальників служб](providers.md) для вашого додатка. Постачальники служб відповідають за початкове завантаження всіх різноманітних компонентів інфраструктури, таких як база даних, черги, валідація, та маршрутизація. Всі постачальники служб для додатка налаштовані в масиві `providers` конфігураційного файла `config/app.php`.

Laravel буде переглядати цей список постачальників служб і створювати екземпляри кожного з них. Після створення екземплярів метод `register` буде викликано для всіх постачальників служб. Потім, коли всі постачальники будуть зареєстровані, метод `boot` буде викликано для кожного постачальника служб. Це зроблено для того, щоб постачальники служб мали можливість залежати від кожного з зареєстрованих та доступних «зв'язувань контейнера» до моменту виконання їхнього метода `boot`.

По суті, кожна основна функція, яку пропонує Laravel, завантажується та налаштовується постачальником служб. Оскільки вони завантажують і налаштовують так багато функцій, пропонованих фреймворком, що постачальники служб є найважливішим аспектом всього процесу завантаження Laravel.

<a name="routing"></a>

### Маршрутизація

Одним із найважливіших постачальників служб у вашому додатку є `App\Providers\RouteServiceProvider`. Цей постачальник служб завантажує файли маршрутів, які розташовані в каталозі `routes` вашого додатка. Давайте, відкрийте код `RouteServiceProvider` і подивіться, як він працює!

Після того як завантажиться додаток, та всі постачальники служб зареєструються, `Request` буде передано на маршрутизатор для виконання. Маршрутизатор надішле запит до маршрута або контролера, а також запустить посередника для маршрута.

Посередник забезпечує зручний механізм для фільтрації або перевірки HTTP-запитів, які надходять у ваш додаток. Наприклад, Laravel містить посередника, який перевіряє, чи автентифікований користувач вашого додатка. Якщо користувач не автентифікований, посередник перенаправить користувача на екран входу. Однак, якщо користувач автентифікований, посередник дозволить запиту перейти далі в додаток. Деякі посередники призначається всім маршрутам в додатку, як-от ті, що визначені у властивості `$middleware` вашого HTTP-ядра, тоді як деякі призначаються лише певним маршрутам або групам маршрутів. Ви можете дізнатися більше, прочитавши повну [документацію про посередників](middleware.md).

Якщо запит проходить через всі призначені посередники відповідного маршрута, метод маршрута або контролера буде виконано, а відповідь, віддана методом маршрута або контролера, буде відправлена назад через ланцюжок посередників маршрута.

<a name="finishing-up"></a>

### Завершення

Щойно метод маршрута або контролера віддає відповідь, вона повертається назовні через посередника маршрута, даючи додатку можливість змінити або перевірити вихідну відповідь.

Нарешті, коли відповідь повертається через посередник, метод `handle` HTTP-ядра, віддає об’єкт відповіді, а файл `index.php` викликає метод `send` для отриманої відповіді. Метод `send` відправляє вміст відповіді до веб-браузера користувача. Нарешті, ми закінчили нашу подорож через весь життєвий цикл запита Laravel!

<a name="focus-on-service-providers"></a>

## Зосередження на постачальниках служб

Постачальники служб дійсно є ключем до завантаження додатка Laravel. Створюється екземпляр додатка, реєструються постачальники служб, і запит передається додтаку, який завантажується. Це справді так просто!

Дуже важливо мати чітке уявлення про те, як створюється та завантажується додатк Laravel через постачальників служб.Постачальники служб додатка зберігаються в каталозі `app/Providers`.

За замовчуванням `AppServiceProvider` відносно порожній. Цей постачальник є чудовим місцем для додавання власної ініціалізації та зв'язувань контейнера служб вашого додатка. Для великих додатків ви можете створити декілька постачальників служб, кожен з яких деталізує початкове завантаження для конкретних служб, які використовуються вашим додатком.
